---
kind: pipeline
type: docker
name: hello

platform:
  os: linux
  arch: arm64

steps:
- name: hello
  image: busybox
  commands:
  - echo hello world
 
trigger:
  branch:
  - main

---
kind: pipeline
type: docker
name: haproxy

platform:
  os: linux
  arch: arm64

steps:
- name: verify-haproxy-config
  image: haproxy:2.7
  commands:
  - haproxy -f nomad/infra/web/haproxy.cfg -c
 
trigger:
  branch:
  - main

---
kind: pipeline
type: docker
name: prom-config

platform:
  os: linux

steps:
- name: verify-prometheus-config
  image: gerrowadat/docker-promtool
  commands:
  - promtool check config monitoring/prometheus.yml
 
trigger:
  branch:
  - main

---
kind: pipeline
type: docker
name: bind-dns-config

platform:
  os: linux

steps:
- name: verify-bind-dns-config
  image: ubuntu/bind9:latest
  commands:
  - ln -sf /drone/src/dns/etc-bind/ /etc/bind/
  - ls -al /etc/bind
  - named-checkconf -z /etc/bind/named.conf
 
trigger:
  branch:
  - main

